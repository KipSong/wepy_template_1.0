'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _wepy = require('./../npm/wepy/lib/wepy.js');

var _wepy2 = _interopRequireDefault(_wepy);

var _index = require('./../config/index.js');

var _index2 = _interopRequireDefault(_index);

var _wxSystem = require('./wx-system.js');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var env = 'dev';

var HTTP_STATUS = {
  SUCCESS: 200,
  CREATED: 201,
  ACCEPTED: 202,
  CLIENT_ERROR: 400,
  AUTHENTICATE: 301,
  FORBIDDEN: 403,
  NOT_FOUND: 404,
  SERVER_ERROR: 500,
  BAD_GATEWAY: 502,
  SERVICE_UNAVAILABLE: 503,
  GATEWAY_TIMEOUT: 504
};

var CHECK_RESPONSE_ASYNC = function CHECK_RESPONSE_ASYNC(response, url, param) {
  switch (env) {
    case 'dev':
      DEV_CHECK(response, url, param);
      break;
    case 'test':
      TEST_CHECK(response, url, param);
      break;
    default:
  }
};

/**
 * @author Kip song
 * @param {*} response
 */
var DEV_CHECK = function DEV_CHECK(response, url, param) {
  if (response.statusCode !== 200) {
    console.error('\u9519\u8BEF\u4FE1\u606F\uFF1A\n' + env + '\u73AF\u5883\uFF1A\u63A5\u53E3\u5931\u8D25 \n\u72B6\u6001\u7801\uFF1A' + response.statusCode + '\n\u8BF7\u6C42\u5730\u5740\uFF1A' + url + '\n\u8BF7\u6C42\u53C2\u6570\uFF1A' + JSON.stringify(param) + ' \nToken\uFF1A' + (0, _wxSystem.getToken)());
  } else {
    var _data = response.data;
    console.log(env + '\u73AF\u5883\uFF1A\u8BF7\u6C42\u6210\u529F', _data);
    if (!_data.state) {
      console.error('\u9519\u8BEF\u4FE1\u606F\uFF1A\n' + env + '\u73AF\u5883\uFF1A\u63A5\u53E3\u6570\u636E\u9519\u8BEF \n\u72B6\u6001\u7801\uFF1A\u7A7A');
    } else if (_data.state == 1) {
      return;
    } else if (_data.state == 2) {
      console.error('\u9519\u8BEF\u4FE1\u606F\uFF1A\n' + env + '\u73AF\u5883\uFF1A\u63A5\u53E3\u6570\u636E\u9519\u8BEF \n\u72B6\u6001\u7801\uFF1A' + _data.state + ' \n\u8BF7\u6C42\u5730\u5740\uFF1A' + url + '\n\u8BF7\u6C42\u53C2\u6570\uFF1A' + JSON.stringify(param) + ' \nToken\uFF1A' + (0, _wxSystem.getToken)() + ' \n\u63A5\u53E3\u8FD4\u56DE\uFF1A' + JSON.stringify(_data));
    } else if (_data.state == 3) {
      console.error('\u9519\u8BEF\u4FE1\u606F\uFF1A\n' + env + '\u73AF\u5883\uFF1A\u767B\u5F55\u5931\u6548 \n\u72B6\u6001\u7801\uFF1A' + _data.state + ' \n\u8BF7\u6C42\u5730\u5740\uFF1A' + url + '\n\u8BF7\u6C42\u53C2\u6570\uFF1A' + JSON.stringify(param) + ' \nToken\uFF1A' + (0, _wxSystem.getToken)() + ' \n\u63A5\u53E3\u8FD4\u56DE\uFF1A' + JSON.stringify(_data));
    }
  }
};

var TEST_CHECK = function TEST_CHECK(response, url, param) {
  if (response.statusCode !== 200) {
    console.error('\u9519\u8BEF\u4FE1\u606F\uFF1A\n' + env + '\u73AF\u5883\uFF1A\u63A5\u53E3\u5931\u8D25 \n\u72B6\u6001\u7801\uFF1A' + response.statusCode + '\n\u8BF7\u6C42\u5730\u5740\uFF1A' + url + '\n\u8BF7\u6C42\u53C2\u6570\uFF1A' + JSON.stringify(param) + ' \nToken\uFF1A' + (0, _wxSystem.getToken)());
  } else {
    var _data = response.data;
    console.log(env + '\u73AF\u5883\uFF1A\u8BF7\u6C42\u6210\u529F', _data);
    if (!_data.state) {
      console.error('\u9519\u8BEF\u4FE1\u606F\uFF1A\n' + env + '\u73AF\u5883\uFF1A\u63A5\u53E3\u6570\u636E\u9519\u8BEF \n\u72B6\u6001\u7801\uFF1A\u7A7A');
    } else if (_data.state == 1) {
      return;
    } else if (_data.state == 2) {
      console.error('\u9519\u8BEF\u4FE1\u606F\uFF1A\n' + env + '\u73AF\u5883\uFF1A\u63A5\u53E3\u6570\u636E\u9519\u8BEF \n\u72B6\u6001\u7801\uFF1A' + _data.state + ' \n\u8BF7\u6C42\u5730\u5740\uFF1A' + url + '\n\u8BF7\u6C42\u53C2\u6570\uFF1A' + JSON.stringify(param) + ' \nToken\uFF1A' + (0, _wxSystem.getToken)() + ' \n\u63A5\u53E3\u8FD4\u56DE\uFF1A' + JSON.stringify(_data));
    } else if (_data.state == 3) {
      console.error('\u9519\u8BEF\u4FE1\u606F\uFF1A\n' + env + '\u73AF\u5883\uFF1A\u767B\u5F55\u5931\u6548 \n\u72B6\u6001\u7801\uFF1A' + _data.state + ' \n\u8BF7\u6C42\u5730\u5740\uFF1A' + url + '\n\u8BF7\u6C42\u53C2\u6570\uFF1A' + JSON.stringify(param) + ' \nToken\uFF1A' + (0, _wxSystem.getToken)() + ' \n\u63A5\u53E3\u8FD4\u56DE\uFF1A' + JSON.stringify(_data));
    }
  }
};

var CHECK_NETWORK_OUT = function CHECK_NETWORK_OUT(response, url, param) {
  console.error('\u9519\u8BEF\u4FE1\u606F\uFF1A\n' + env + '\u73AF\u5883\uFF1A\u8BF7\u6C42\u8D85\u65F6 \n\u8BF7\u6C42\u5730\u5740\uFF1A' + url + '\n\u8BF7\u6C42\u53C2\u6570\uFF1A' + JSON.stringify(param) + ' \nToken\uFF1A' + (0, _wxSystem.getToken)());
};

var HANDLE_RESPONSE_SUCCESS = function HANDLE_RESPONSE_SUCCESS(data) {};

exports.default = {
  /**
   * @author Kip song
   * @param {*} params
   * @param {*} method
   */
  baseOptions: function baseOptions(params) {
    var method = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "GET";

    return new Promise(function (resolve, reject) {
      var url = params.url,
          data = params.data;

      var contentType = "application/json";
      contentType = params.contentType || contentType;
      var option = {
        url: url.indexOf("http") !== -1 ? url : _index2.default.url + url,
        data: data,
        method: method,
        header: { 'content-type': contentType, 'access-token': (0, _wxSystem.getToken)() },
        success: function success(res) {
          CHECK_RESPONSE_ASYNC(res, option.url, data);
          if (res.statusCode === HTTP_STATUS.NOT_FOUND) {
            wx.hideLoading();
            _wepy2.default.showToast({
              title: '服务器找不到您所请求的文件或脚本！',
              icon: 'none',
              duration: 1500
            });
          } else if (res.statusCode === HTTP_STATUS.BAD_GATEWAY) {
            wx.hideLoading();
            _wepy2.default.showToast({
              title: '服务端异常，请稍后尝试！',
              icon: 'none',
              duration: 1500
            });
          } else if (res.statusCode === HTTP_STATUS.FORBIDDEN) {
            wx.hideLoading();
            _wepy2.default.showToast({
              title: '没有权限访问！',
              icon: 'none',
              duration: 1500
            });
          } else if (res.statusCode === HTTP_STATUS.SUCCESS) {
            var _data = res.data;
            if (_data.state == 1 && _data.data) {
              resolve(_data.data);
            } else if (_data.state == 2) {
              if (data && data.RETURN) {
                console.warn('过滤拦截，不做处理');
              } else if (_data.code == 100018) {
                wx.navigateTo({
                  url: "../pages/login"
                });
              } else {
                _wepy2.default.showToast({
                  title: _data.msg || _data.message || '\u9519\u8BEF\u72B6\u6001' + _data.code,
                  icon: 'none',
                  duration: 1500
                });
              }
            } else if (_data.state == 3) {
              _wepy2.default.showToast({
                title: "未登录，请重新登录！",
                icon: 'none',
                duration: 1500
              });
            }
          } else {
            wx.hideLoading();
            _wepy2.default.showToast({
              title: '网络出现故障，请重新尝试！',
              icon: 'none',
              duration: 1500
            });
          }
        },
        fail: function fail(e) {
          CHECK_NETWORK_OUT();
          _wepy2.default.showToast({
            title: '网络超时，请重新操作！',
            icon: 'none',
            duration: 1500
          });
        }
      };
      wx.request(option);
    });
  },

  /**
     * GET请求
     * @param url 请求路径
     * @param data 参数
     */
  get: function get(url, data) {
    var option = { url: url, data: data };
    return this.baseOptions(option, "GET");
  },

  /**
   * POST请求
   * @param url 请求路径
   * @param data 参数
   */
  post: function post(url, data) {
    var option = { url: url, data: data };
    return this.baseOptions(option, "POST");
  },

  /**
   * PUT请求
   * @param url 请求路径
   * @param data 参数
   */
  put: function put(url, data) {
    var option = { url: url, data: data };
    return this.baseOptions(option, "PUT");
  },

  /**
   * DELETE请求
   * @param url 请求路径
   * @param data 参数
   */
  delete: function _delete(url, data) {
    var option = { url: url, data: data };
    return this.baseOptions(option, "DELETE");
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlcXVlc3QuanMiXSwibmFtZXMiOlsiZW52IiwiSFRUUF9TVEFUVVMiLCJTVUNDRVNTIiwiQ1JFQVRFRCIsIkFDQ0VQVEVEIiwiQ0xJRU5UX0VSUk9SIiwiQVVUSEVOVElDQVRFIiwiRk9SQklEREVOIiwiTk9UX0ZPVU5EIiwiU0VSVkVSX0VSUk9SIiwiQkFEX0dBVEVXQVkiLCJTRVJWSUNFX1VOQVZBSUxBQkxFIiwiR0FURVdBWV9USU1FT1VUIiwiQ0hFQ0tfUkVTUE9OU0VfQVNZTkMiLCJyZXNwb25zZSIsInVybCIsInBhcmFtIiwiREVWX0NIRUNLIiwiVEVTVF9DSEVDSyIsInN0YXR1c0NvZGUiLCJjb25zb2xlIiwiZXJyb3IiLCJKU09OIiwic3RyaW5naWZ5IiwiX2RhdGEiLCJkYXRhIiwibG9nIiwic3RhdGUiLCJDSEVDS19ORVRXT1JLX09VVCIsIkhBTkRMRV9SRVNQT05TRV9TVUNDRVNTIiwiYmFzZU9wdGlvbnMiLCJwYXJhbXMiLCJtZXRob2QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImNvbnRlbnRUeXBlIiwib3B0aW9uIiwiaW5kZXhPZiIsImNvbmZpZyIsImhlYWRlciIsInN1Y2Nlc3MiLCJyZXMiLCJ3eCIsImhpZGVMb2FkaW5nIiwid2VweSIsInNob3dUb2FzdCIsInRpdGxlIiwiaWNvbiIsImR1cmF0aW9uIiwiUkVUVVJOIiwid2FybiIsImNvZGUiLCJuYXZpZ2F0ZVRvIiwibXNnIiwibWVzc2FnZSIsImZhaWwiLCJlIiwicmVxdWVzdCIsImdldCIsInBvc3QiLCJwdXQiLCJkZWxldGUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUdBLElBQU1BLFdBQU47O0FBRUEsSUFBTUMsY0FBYztBQUNsQkMsV0FBUyxHQURTO0FBRWxCQyxXQUFTLEdBRlM7QUFHbEJDLFlBQVUsR0FIUTtBQUlsQkMsZ0JBQWMsR0FKSTtBQUtsQkMsZ0JBQWMsR0FMSTtBQU1sQkMsYUFBVyxHQU5PO0FBT2xCQyxh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O0FBQ0QsR0E5Rlk7O0FBK0ZiOzs7OztBQUtBdUIsTUFwR2EsZ0JBb0dSN0MsR0FwR1EsRUFvR0hVLElBcEdHLEVBb0dHO0FBQ2QsUUFBSVksU0FBUyxFQUFFdEIsUUFBRixFQUFPVSxVQUFQLEVBQWI7QUFDQSxXQUFPLEtBQUtLLFdBQUwsQ0FBaUJPLE1BQWpCLEVBQXlCLE1BQXpCLENBQVA7QUFDRCxHQXZHWTs7QUF3R2I7Ozs7O0FBS0F3QixLQTdHYSxlQTZHVDlDLEdBN0dTLEVBNkdKVSxJQTdHSSxFQTZHRTtBQUNiLFFBQUlZLFNBQVMsRUFBRXRCLFFBQUYsRUFBT1UsVUFBUCxFQUFiO0FBQ0EsV0FBTyxLQUFLSyxXQUFMLENBQWlCTyxNQUFqQixFQUF5QixLQUF6QixDQUFQO0FBQ0QsR0FoSFk7O0FBaUhiOzs7OztBQUtBeUIsUUF0SGEsbUJBc0hOL0MsR0F0SE0sRUFzSERVLElBdEhDLEVBc0hLO0FBQ2hCLFFBQUlZLFNBQVMsRUFBRXRCLFFBQUYsRUFBT1UsVUFBUCxFQUFiO0FBQ0EsV0FBTyxLQUFLSyxXQUFMLENBQWlCTyxNQUFqQixFQUF5QixRQUF6QixDQUFQO0FBQ0Q7QUF6SFksQyIsImZpbGUiOiJyZXF1ZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHdlcHkgZnJvbSAnd2VweSdcbmltcG9ydCBjb25maWcgZnJvbSAnLi4vY29uZmlnL2luZGV4J1xuaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICcuLi9saWIvd3gtc3lzdGVtJ1xuXG5cbmNvbnN0IGVudiA9IF9fTk9ERV9FTlZfX1xuXG5jb25zdCBIVFRQX1NUQVRVUyA9IHtcbiAgU1VDQ0VTUzogMjAwLFxuICBDUkVBVEVEOiAyMDEsXG4gIEFDQ0VQVEVEOiAyMDIsXG4gIENMSUVOVF9FUlJPUjogNDAwLFxuICBBVVRIRU5USUNBVEU6IDMwMSxcbiAgRk9SQklEREVOOiA0MDMsXG4gIE5PVF9GT1VORDogNDA0LFxuICBTRVJWRVJfRVJST1I6IDUwMCxcbiAgQkFEX0dBVEVXQVk6IDUwMixcbiAgU0VSVklDRV9VTkFWQUlMQUJMRTogNTAzLFxuICBHQVRFV0FZX1RJTUVPVVQ6IDUwNFxufVxuXG5jb25zdCBDSEVDS19SRVNQT05TRV9BU1lOQyA9IChyZXNwb25zZSwgdXJsLCBwYXJhbSkgPT4ge1xuICBzd2l0Y2ggKGVudikge1xuICAgIGNhc2UgJ2Rldic6XG4gICAgICBERVZfQ0hFQ0socmVzcG9uc2UsIHVybCwgcGFyYW0pXG4gICAgICBicmVhaztcbiAgICBjYXNlICd0ZXN0JzpcbiAgICAgIFRFU1RfQ0hFQ0socmVzcG9uc2UsIHVybCwgcGFyYW0pXG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICB9XG59XG5cbi8qKlxuICogQGF1dGhvciBLaXAgc29uZ1xuICogQHBhcmFtIHsqfSByZXNwb25zZVxuICovXG5jb25zdCBERVZfQ0hFQ0sgPSAocmVzcG9uc2UsIHVybCwgcGFyYW0pID0+IHtcbiAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgIT09IDIwMCkge1xuICAgIGNvbnNvbGUuZXJyb3IoYOmUmeivr+S/oeaBr++8mlxcbiR7ZW52feeOr+Wig++8muaOpeWPo+Wksei0pSBcXG7nirbmgIHnoIHvvJoke3Jlc3BvbnNlLnN0YXR1c0NvZGV9XFxu6K+35rGC5Zyw5Z2A77yaJHt1cmx9XFxu6K+35rGC5Y+C5pWw77yaJHtKU09OLnN0cmluZ2lmeShwYXJhbSl9IFxcblRva2Vu77yaJHtnZXRUb2tlbigpfWApXG4gIH0gZWxzZSB7XG4gICAgbGV0IF9kYXRhID0gcmVzcG9uc2UuZGF0YVxuICAgIGNvbnNvbGUubG9nKGAke2Vudn3njq/looPvvJror7fmsYLmiJDlip9gLCBfZGF0YSlcbiAgICBpZiAoIV9kYXRhLnN0YXRlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGDplJnor6/kv6Hmga/vvJpcXG4ke2Vudn3njq/looPvvJrmjqXlj6PmlbDmja7plJnor68gXFxu54q25oCB56CB77ya56m6YClcbiAgICB9IGVsc2UgaWYgKF9kYXRhLnN0YXRlID09IDEpIHtcbiAgICAgIHJldHVyblxuICAgIH0gZWxzZSBpZiAoX2RhdGEuc3RhdGUgPT0gMikge1xuICAgICAgY29uc29sZS5lcnJvcihg6ZSZ6K+v5L+h5oGv77yaXFxuJHtlbnZ9546v5aKD77ya5o6l5Y+j5pWw5o2u6ZSZ6K+vIFxcbueKtuaAgeegge+8miR7X2RhdGEuc3RhdGV9IFxcbuivt+axguWcsOWdgO+8miR7dXJsfVxcbuivt+axguWPguaVsO+8miR7SlNPTi5zdHJpbmdpZnkocGFyYW0pfSBcXG5Ub2tlbu+8miR7Z2V0VG9rZW4oKX0gXFxu5o6l5Y+j6L+U5Zue77yaJHtKU09OLnN0cmluZ2lmeShfZGF0YSl9YClcbiAgICB9IGVsc2UgaWYgKF9kYXRhLnN0YXRlID09IDMpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOmUmeivr+S/oeaBr++8mlxcbiR7ZW52feeOr+Wig++8mueZu+W9leWkseaViCBcXG7nirbmgIHnoIHvvJoke19kYXRhLnN0YXRlfSBcXG7or7fmsYLlnLDlnYDvvJoke3VybH1cXG7or7fmsYLlj4LmlbDvvJoke0pTT04uc3RyaW5naWZ5KHBhcmFtKX0gXFxuVG9rZW7vvJoke2dldFRva2VuKCl9IFxcbuaOpeWPo+i/lOWbnu+8miR7SlNPTi5zdHJpbmdpZnkoX2RhdGEpfWApXG4gICAgfVxuICB9XG59XG5cbmNvbnN0IFRFU1RfQ0hFQ0sgPSAocmVzcG9uc2UsIHVybCwgcGFyYW0pID0+IHtcbiAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgIT09IDIwMCkge1xuICAgIGNvbnNvbGUuZXJyb3IoYOmUmeivr+S/oeaBr++8mlxcbiR7ZW52feeOr+Wig++8muaOpeWPo+Wksei0pSBcXG7nirbmgIHnoIHvvJoke3Jlc3BvbnNlLnN0YXR1c0NvZGV9XFxu6K+35rGC5Zyw5Z2A77yaJHt1cmx9XFxu6K+35rGC5Y+C5pWw77yaJHtKU09OLnN0cmluZ2lmeShwYXJhbSl9IFxcblRva2Vu77yaJHtnZXRUb2tlbigpfWApXG4gIH0gZWxzZSB7XG4gICAgbGV0IF9kYXRhID0gcmVzcG9uc2UuZGF0YVxuICAgIGNvbnNvbGUubG9nKGAke2Vudn3njq/looPvvJror7fmsYLmiJDlip9gLCBfZGF0YSlcbiAgICBpZiAoIV9kYXRhLnN0YXRlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGDplJnor6/kv6Hmga/vvJpcXG4ke2Vudn3njq/looPvvJrmjqXlj6PmlbDmja7plJnor68gXFxu54q25oCB56CB77ya56m6YClcbiAgICB9IGVsc2UgaWYgKF9kYXRhLnN0YXRlID09IDEpIHtcbiAgICAgIHJldHVyblxuICAgIH0gZWxzZSBpZiAoX2RhdGEuc3RhdGUgPT0gMikge1xuICAgICAgY29uc29sZS5lcnJvcihg6ZSZ6K+v5L+h5oGv77yaXFxuJHtlbnZ9546v5aKD77ya5o6l5Y+j5pWw5o2u6ZSZ6K+vIFxcbueKtuaAgeegge+8miR7X2RhdGEuc3RhdGV9IFxcbuivt+axguWcsOWdgO+8miR7dXJsfVxcbuivt+axguWPguaVsO+8miR7SlNPTi5zdHJpbmdpZnkocGFyYW0pfSBcXG5Ub2tlbu+8miR7Z2V0VG9rZW4oKX0gXFxu5o6l5Y+j6L+U5Zue77yaJHtKU09OLnN0cmluZ2lmeShfZGF0YSl9YClcbiAgICB9IGVsc2UgaWYgKF9kYXRhLnN0YXRlID09IDMpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOmUmeivr+S/oeaBr++8mlxcbiR7ZW52feeOr+Wig++8mueZu+W9leWkseaViCBcXG7nirbmgIHnoIHvvJoke19kYXRhLnN0YXRlfSBcXG7or7fmsYLlnLDlnYDvvJoke3VybH1cXG7or7fmsYLlj4LmlbDvvJoke0pTT04uc3RyaW5naWZ5KHBhcmFtKX0gXFxuVG9rZW7vvJoke2dldFRva2VuKCl9IFxcbuaOpeWPo+i/lOWbnu+8miR7SlNPTi5zdHJpbmdpZnkoX2RhdGEpfWApXG4gICAgfVxuICB9XG59XG5cbmNvbnN0IENIRUNLX05FVFdPUktfT1VUID0gKHJlc3BvbnNlLCB1cmwsIHBhcmFtKSA9PiB7XG4gIGNvbnNvbGUuZXJyb3IoYOmUmeivr+S/oeaBr++8mlxcbiR7ZW52feeOr+Wig++8muivt+axgui2heaXtiBcXG7or7fmsYLlnLDlnYDvvJoke3VybH1cXG7or7fmsYLlj4LmlbDvvJoke0pTT04uc3RyaW5naWZ5KHBhcmFtKX0gXFxuVG9rZW7vvJoke2dldFRva2VuKCl9YClcbn1cblxuY29uc3QgSEFORExFX1JFU1BPTlNFX1NVQ0NFU1MgPSAoZGF0YSkgPT4ge1xuXG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgLyoqXG4gICAqIEBhdXRob3IgS2lwIHNvbmdcbiAgICogQHBhcmFtIHsqfSBwYXJhbXNcbiAgICogQHBhcmFtIHsqfSBtZXRob2RcbiAgICovXG4gIGJhc2VPcHRpb25zKHBhcmFtcywgbWV0aG9kID0gXCJHRVRcIikge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBsZXQgeyB1cmwsIGRhdGEgfSA9IHBhcmFtc1xuICAgICAgbGV0IGNvbnRlbnRUeXBlID0gXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgIGNvbnRlbnRUeXBlID0gcGFyYW1zLmNvbnRlbnRUeXBlIHx8IGNvbnRlbnRUeXBlXG4gICAgICBjb25zdCBvcHRpb24gPSB7XG4gICAgICAgIHVybDogdXJsLmluZGV4T2YoXCJodHRwXCIpICE9PSAtMSA/IHVybCA6IGNvbmZpZy51cmwgKyB1cmwsXG4gICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgIG1ldGhvZDogbWV0aG9kLFxuICAgICAgICBoZWFkZXI6IHsgJ2NvbnRlbnQtdHlwZSc6IGNvbnRlbnRUeXBlLCAnYWNjZXNzLXRva2VuJzogZ2V0VG9rZW4oKSB9LFxuICAgICAgICBzdWNjZXNzKHJlcykge1xuICAgICAgICAgIENIRUNLX1JFU1BPTlNFX0FTWU5DKHJlcywgb3B0aW9uLnVybCwgZGF0YSlcbiAgICAgICAgICBpZiAocmVzLnN0YXR1c0NvZGUgPT09IEhUVFBfU1RBVFVTLk5PVF9GT1VORCkge1xuICAgICAgICAgICAgd3guaGlkZUxvYWRpbmcoKVxuICAgICAgICAgICAgd2VweS5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICB0aXRsZTogJ+acjeWKoeWZqOaJvuS4jeWIsOaCqOaJgOivt+axgueahOaWh+S7tuaIluiEmuacrO+8gScsXG4gICAgICAgICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgICAgICAgZHVyYXRpb246IDE1MDBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSBlbHNlIGlmIChyZXMuc3RhdHVzQ29kZSA9PT0gSFRUUF9TVEFUVVMuQkFEX0dBVEVXQVkpIHtcbiAgICAgICAgICAgIHd4LmhpZGVMb2FkaW5nKClcbiAgICAgICAgICAgIHdlcHkuc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgdGl0bGU6ICfmnI3liqHnq6/lvILluLjvvIzor7fnqI3lkI7lsJ3or5XvvIEnLFxuICAgICAgICAgICAgICBpY29uOiAnbm9uZScsXG4gICAgICAgICAgICAgIGR1cmF0aW9uOiAxNTAwXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0gZWxzZSBpZiAocmVzLnN0YXR1c0NvZGUgPT09IEhUVFBfU1RBVFVTLkZPUkJJRERFTikge1xuICAgICAgICAgICAgd3guaGlkZUxvYWRpbmcoKVxuICAgICAgICAgICAgd2VweS5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICB0aXRsZTogJ+ayoeacieadg+mZkOiuv+mXru+8gScsXG4gICAgICAgICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgICAgICAgZHVyYXRpb246IDE1MDBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSBlbHNlIGlmIChyZXMuc3RhdHVzQ29kZSA9PT0gSFRUUF9TVEFUVVMuU1VDQ0VTUykge1xuICAgICAgICAgICAgbGV0IF9kYXRhID0gcmVzLmRhdGFcbiAgICAgICAgICAgIGlmIChfZGF0YS5zdGF0ZSA9PSAxICYmIF9kYXRhLmRhdGEpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShfZGF0YS5kYXRhKVxuICAgICAgICAgICAgfSBlbHNlIGlmIChfZGF0YS5zdGF0ZSA9PSAyKSB7XG4gICAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEuUkVUVVJOKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCfov4fmu6Tmi6bmiKrvvIzkuI3lgZrlpITnkIYnKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYgKF9kYXRhLmNvZGUgPT0gMTAwMDE4KSB7XG4gICAgICAgICAgICAgICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICAgICAgICAgICAgICB1cmw6IFwiLi4vcGFnZXMvbG9naW5cIlxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgd2VweS5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICAgICAgdGl0bGU6IF9kYXRhLm1zZyB8fCBfZGF0YS5tZXNzYWdlIHx8IGDplJnor6/nirbmgIEke19kYXRhLmNvZGV9YCxcbiAgICAgICAgICAgICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxNTAwXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChfZGF0YS5zdGF0ZSA9PSAzKSB7XG4gICAgICAgICAgICAgIHdlcHkuc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogXCLmnKrnmbvlvZXvvIzor7fph43mlrDnmbvlvZXvvIFcIixcbiAgICAgICAgICAgICAgICBpY29uOiAnbm9uZScsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDE1MDBcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgd3guaGlkZUxvYWRpbmcoKVxuICAgICAgICAgICAgd2VweS5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICB0aXRsZTogJ+e9kee7nOWHuueOsOaVhemanO+8jOivt+mHjeaWsOWwneivle+8gScsXG4gICAgICAgICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgICAgICAgZHVyYXRpb246IDE1MDBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBmYWlsKGUpIHtcbiAgICAgICAgICBDSEVDS19ORVRXT1JLX09VVCgpXG4gICAgICAgICAgd2VweS5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgdGl0bGU6ICfnvZHnu5zotoXml7bvvIzor7fph43mlrDmk43kvZzvvIEnLFxuICAgICAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICAgICAgZHVyYXRpb246IDE1MDBcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICB3eC5yZXF1ZXN0KG9wdGlvbilcbiAgICB9KVxuICB9LFxuICAvKipcbiAgICAgKiBHRVTor7fmsYJcbiAgICAgKiBAcGFyYW0gdXJsIOivt+axgui3r+W+hFxuICAgICAqIEBwYXJhbSBkYXRhIOWPguaVsFxuICAgICAqL1xuICBnZXQodXJsLCBkYXRhKSB7XG4gICAgbGV0IG9wdGlvbiA9IHsgdXJsLCBkYXRhIH1cbiAgICByZXR1cm4gdGhpcy5iYXNlT3B0aW9ucyhvcHRpb24sIFwiR0VUXCIpXG4gIH0sXG4gIC8qKlxuICAgKiBQT1NU6K+35rGCXG4gICAqIEBwYXJhbSB1cmwg6K+35rGC6Lev5b6EXG4gICAqIEBwYXJhbSBkYXRhIOWPguaVsFxuICAgKi9cbiAgcG9zdCh1cmwsIGRhdGEpIHtcbiAgICBsZXQgb3B0aW9uID0geyB1cmwsIGRhdGEgfVxuICAgIHJldHVybiB0aGlzLmJhc2VPcHRpb25zKG9wdGlvbiwgXCJQT1NUXCIpXG4gIH0sXG4gIC8qKlxuICAgKiBQVVTor7fmsYJcbiAgICogQHBhcmFtIHVybCDor7fmsYLot6/lvoRcbiAgICogQHBhcmFtIGRhdGEg5Y+C5pWwXG4gICAqL1xuICBwdXQodXJsLCBkYXRhKSB7XG4gICAgbGV0IG9wdGlvbiA9IHsgdXJsLCBkYXRhIH1cbiAgICByZXR1cm4gdGhpcy5iYXNlT3B0aW9ucyhvcHRpb24sIFwiUFVUXCIpXG4gIH0sXG4gIC8qKlxuICAgKiBERUxFVEXor7fmsYJcbiAgICogQHBhcmFtIHVybCDor7fmsYLot6/lvoRcbiAgICogQHBhcmFtIGRhdGEg5Y+C5pWwXG4gICAqL1xuICBkZWxldGUodXJsLCBkYXRhKSB7XG4gICAgbGV0IG9wdGlvbiA9IHsgdXJsLCBkYXRhIH1cbiAgICByZXR1cm4gdGhpcy5iYXNlT3B0aW9ucyhvcHRpb24sIFwiREVMRVRFXCIpXG4gIH1cbn1cbiJdfQ==